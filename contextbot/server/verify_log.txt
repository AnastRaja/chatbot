Starting Lead Extraction Test...
Processing message...
handleIncomingMessage returned: {"response":"I'm having a little trouble connecting right now. Could you try asking that again?","sessionId":"mock-session-id-123"}
Waiting for async lead extraction...
Verification complete. Results written to verification_result.json
Starting Lead Extraction Test...
Processing message...
AIService.generateResponse called
Lead.findOne called with query: {"projectId":"test-biz-id-777","$or":[{"chatSessionId":"mock-session-id-123"},{"contactDetails.emails":{"$in":["john.test@example.com"]}},{"contactDetails.phones":{"$in":["5550199"]}}]}
Lead.create called with data: {"projectId":"test-biz-id-777","chatSessionId":"mock-session-id-123","rawMessage":"Hi, my name is John Test, email is john.test@example.com","contactDetails":{"isLead":true,"emails":["john.test@example.com"],"phones":["5550199"],"name":"John Test","country":"Canada"},"businessName":"Test Business Inc."}
handleIncomingMessage returned: {"response":"Thank you! I've noted your details.","sessionId":"mock-session-id-123"}
Waiting for async lead extraction...
Verification complete. Results written to verification_result.json
